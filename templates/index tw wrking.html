<!doctype html>
<html lang="{{ default_language | default('es') }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Acceso Wi-Fi - Grupo Tierra Gaucha</title>

  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-tr from-red-200 via-blue-300 to-sky-300 min-h-screen flex items-center justify-center">

<!-- ===================== CONTENEDOR PRINCIPAL ===================== -->
<div id="mainContent" class="w-full max-w-sm p-6 bg-white rounded-2xl shadow">

  <!-- LOGO -->
    <div class="flex justify-center mb-4">
      <img src="{{ request.url_for('static', path=logo_file) }}" alt="Logo {{ hotel_name }}" class="w-64 h-64 object-contain">


    </div>

  <!-- TITULO -->
  <h1 class="text-xl font-semibold text-center mb-4">
    {{ hotel_name }}
  </h1>
  <!-- ===================== FLAGS ===================== -->
   <div class="flex justify-center gap-4 mt-6 text-sm mb-4 ">
    <button onclick="setLang('es')">ðŸ‡¦ðŸ‡·</button>
    <button onclick="setLang('en')">ðŸ‡ºðŸ‡¸</button>
    <button onclick="setLang('pt')">ðŸ‡§ðŸ‡·</button>
  </div>
  <!-- ===================== MENSAJES ===================== -->
  {% if status == "error" %}
    <div class="mb-4 mt-6text-sm text-red-700 bg-red-100 p-3 rounded">
      <span data-i18n="error_form"></span>
    </div>
  {% elif status == "error_unifi" %}
    <div class="mb-4 text-sm text-red-700 bg-red-100 p-3 rounded">
      <span data-i18n="error_unifi"></span>
    </div>
  {% endif %}

  <!-- ===================== FORMULARIO ===================== -->
  <form method="post" class="space-y-4 mt-6">

    <input type="text" name="fullname" required
      class="w-full border rounded px-3 py-2"
      placeholder="" data-i18n-placeholder="fullname">

    <input type="email" name="email" required
      class="w-full border rounded px-3 py-2"
      placeholder="" data-i18n-placeholder="email">

    <input type="text" name="phone"
      class="w-full border rounded px-3 py-2"
      placeholder="" data-i18n-placeholder="phone">

    <button type="submit"
      class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
      <span data-i18n="connect"></span>
    </button>

  </form>



</div>

<!-- ===================== OVERLAY CONECTANDO ===================== -->
<div id="connectingOverlay"
     class="fixed inset-0 hidden items-center justify-center bg-black/40 backdrop-blur-sm z-50">
  <div class="bg-white rounded-xl p-6 text-center shadow-xl max-w-sm">
    <h2 class="text-lg font-semibold mb-2" data-i18n="connecting"></h2>
    <p class="mb-2" data-i18n="please_wait"></p>
    <p class="text-xs text-gray-500" data-i18n="close_tip"></p>
  </div>
</div>

<!-- ===================== JS ===================== -->
<script>
/* ------------------ DETECCIÃ“N ANDROID ------------------ */
function isAndroidCaptivePortal() {
  const ua = navigator.userAgent || "";
  return ua.includes("CaptivePortalLogin") && ua.includes("Android");
}

function qp(name) {
  return new URLSearchParams(window.location.search).get(name);
}

/* ------------------ I18N ------------------ */
const I18N = {
  es: {
    fullname: "Nombre completo",
    email: "Correo electrÃ³nico",
    phone: "TelÃ©fono (opcional)",
    connect: "Conectarse",
    connecting: "Conectandoâ€¦",
    please_wait: "Espere por favor",
    close_tip: "Si tarda demasiado, pruebe cerrando el portal de autenticaciÃ³n",
    error_form: "Por favor complete correctamente el formulario.",
    error_unifi: "No se pudo autorizar la conexiÃ³n. Intente nuevamente."
  },
  en: {
    fullname: "Full name",
    email: "Email address",
    phone: "Phone (optional)",
    connect: "Connect",
    connecting: "Connectingâ€¦",
    please_wait: "Please wait",
    close_tip: "If it takes too long, try closing the authentication portal",
    error_form: "Please fill out the form correctly.",
    error_unifi: "Could not authorize the connection. Please try again."
  },
  pt: {
    fullname: "Nome completo",
    email: "E-mail",
    phone: "Telefone (opcional)",
    connect: "Conectar",
    connecting: "Conectandoâ€¦",
    please_wait: "Aguarde por favor",
    close_tip: "Se demorar muito, tente fechar o portal de autenticaÃ§Ã£o",
    error_form: "Por favor, preencha o formulÃ¡rio corretamente.",
    error_unifi: "NÃ£o foi possÃ­vel autorizar a conexÃ£o. Tente novamente."
  }
};

let currentLang = localStorage.getItem("lang") || "{{ default_language }}";

function applyLang(lang) {
  currentLang = lang;
  localStorage.setItem("lang", lang);

  document.querySelectorAll("[data-i18n]").forEach(el => {
    el.innerHTML = I18N[lang][el.dataset.i18n];
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
    el.placeholder = I18N[lang][el.dataset.i18nPlaceholder];
  });
}

function setLang(lang) {
  applyLang(lang);
}

/* ------------------ INIT ------------------ */
document.addEventListener("DOMContentLoaded", () => {

  applyLang(currentLang);

  // Solo si fue login OK
  if (qp("status") !== "success") return;

  let target;

  if (isAndroidCaptivePortal()) {
    target = qp("url") || qp("continue_url");
    const overlay = document.getElementById("connectingOverlay");
    overlay.classList.remove("hidden");
    overlay.classList.add("flex");
  } else {
    target = "{{ redirect_url }}";
  }

  if (!target) return;

  setTimeout(() => {
    window.location.href = target;
  }, 2000);

  // Intentar cerrar portal Android
  setTimeout(() => {
    window.close();
  }, 3000);
});
</script>

</body>
</html>
