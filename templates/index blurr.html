<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Acceso WiFi</title>

  <style>
    :root{
      --bg1:#fecaca;
      --bg2:#93c5fd;
      --bg3:#7dd3fc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#6b7280;
      --border:#e5e7eb;
      --primary:#2563eb;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
      background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      color:var(--text);
    }

    .card{
      background:var(--card);
      max-width:420px;
      width:100%;
      border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
      padding:22px;
    }

    .logo{
      width:240px;
      height:240px;
      object-fit:contain;
      margin:0 auto 10px;
      display:block;
      border-radius:12px;
    }

    h1{
      text-align:center;
      font-size:20px;
      margin:10px 0;
    }

    .flags{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-bottom:14px;
    }

    .flag{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:6px 10px;
      cursor:pointer;
      font-size:16px;
    }

    .field{ margin-bottom:12px; }

    input{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--border);
      font-size:15px;
    }

    input:focus{
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(37,99,235,.2);
    }

    button{
      width:100%;
      padding:12px;
      border:none;
      border-radius:12px;
      background:var(--primary);
      color:#fff;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
    }

    /* ================= OVERLAY ================= */

    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index:9999;
    }

    .overlay.show{ display:flex; }

    .overlay-card{
      background:#fff;
      border-radius:16px;
      padding:22px;
      text-align:center;
      max-width:340px;
      width:100%;
      box-shadow:0 20px 60px rgba(0,0,0,.3);
    }

    .spinner{
      width:36px;
      height:36px;
      border-radius:50%;
      border:4px solid rgba(0,0,0,.15);
      border-top-color:var(--primary);
      margin:0 auto 14px;
      animation:spin .9s linear infinite;
    }

    @keyframes spin{ to{ transform:rotate(360deg);} }

    .overlay-title{
      font-size:20px;
      font-weight:800;
      margin-bottom:6px;
    }

    .overlay-text{
      font-size:15px;
      margin-bottom:6px;
    }

    .overlay-tip{
      font-size:12px;
      color:var(--muted);
    }
  </style>
</head>

<body>

  <div class="card">
    <img src="{{ request.url_for('static', path=logo_file) }}" class="logo">

    <h1>{{ hotel_name }}</h1>

    <div class="flags">
      <button class="flag" onclick="setLang('es')">ðŸ‡¦ðŸ‡·</button>
      <button class="flag" onclick="setLang('en')">ðŸ‡ºðŸ‡¸</button>
      <button class="flag" onclick="setLang('pt')">ðŸ‡§ðŸ‡·</button>
    </div>

    <form method="post" id="loginForm">
      <div class="field">
        <input name="fullname" required data-ph="fullname">
      </div>
      <div class="field">
        <input type="email" name="email" required data-ph="email">
      </div>
      <div class="field">
        <input name="phone" data-ph="phone">
      </div>

      <button type="submit" data-t="connect"></button>
    </form>
  </div>

  <!-- OVERLAY -->
  <div id="overlay" class="overlay">
    <div class="overlay-card">
      <div class="spinner"></div>
      <div class="overlay-title" data-t="connecting"></div>
      <div class="overlay-text" data-t="wait"></div>
      <div class="overlay-tip" data-t="tip"></div>
    </div>
  </div>

<script>
/* ================= I18N ================= */
const T = {
  es:{
    fullname:"Nombre completo",
    email:"Correo electrÃ³nico",
    phone:"TelÃ©fono (opcional)",
    connect:"Conectarse",
    connecting:"Conectandoâ€¦",
    wait:"Espere por favor",
    tip:"Si tarda demasiado pruebe cerrando el portal de autenticaciÃ³n"
  },
  en:{
    fullname:"Full name",
    email:"Email address",
    phone:"Phone (optional)",
    connect:"Connect",
    connecting:"Connectingâ€¦",
    wait:"Please wait",
    tip:"If it takes too long, try closing the authentication portal"
  },
  pt:{
    fullname:"Nome completo",
    email:"E-mail",
    phone:"Telefone (opcional)",
    connect:"Conectar",
    connecting:"Conectandoâ€¦",
    wait:"Aguarde por favor",
    tip:"Se demorar muito, tente fechar o portal de autenticaÃ§Ã£o"
  }
};

let lang = localStorage.getItem("lang") || "es";

function applyLang(){
  document.querySelectorAll("[data-ph]").forEach(e=>{
    e.placeholder = T[lang][e.dataset.ph];
  });
  document.querySelectorAll("[data-t]").forEach(e=>{
    e.innerHTML = T[lang][e.dataset.t];
  });
}

function setLang(l){
  lang = l;
  localStorage.setItem("lang",l);
  applyLang();
}

applyLang();

/* ================= LOGICA PORTAL ================= */
function isAndroidPortal(){
  return navigator.userAgent.includes("Android")
      && navigator.userAgent.includes("CaptivePortalLogin");
}

const overlay = document.getElementById("overlay");
const form = document.getElementById("loginForm");

form.addEventListener("submit", ()=>{
  overlay.classList.add("show");
});

/* Al volver con status=success */
if (new URLSearchParams(location.search).get("status") === "success") {
  overlay.classList.add("show");

  const params = new URLSearchParams(location.search);
  const target = isAndroidPortal()
    ? params.get("url") || params.get("continue_url")
    : "{{ redirect_url }}";

  setTimeout(()=>{
    if (target) location.href = target;
  },2000);

  setTimeout(()=>{
    try{ window.close(); }catch(e){}
  },3000);
}
</script>

</body>
</html>
